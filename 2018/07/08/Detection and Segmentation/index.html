<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-TW">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/aKRHHmA.jpg?v=7.0.1">



  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="簡述CS231n Lecture 11的內容 先說一下目前有哪些問題 Semantic Segmentation簡述只在乎pixelLabel圖片中所有的pixel來分類 不可行…計算量太大 換個方法 一開始計算量很大 問題來了Upsampling怎麼做 有兩種 如圖要碼複製 要碼放0 另外一種取最大 當做是Rescale   FCN(Fully Convolutional networks)綜述">
<meta name="keywords" content="CS231n,Object Detection">
<meta property="og:type" content="article">
<meta property="og:title" content="Detection and Segmentation">
<meta property="og:url" content="https://accelsao.github.io/2018/07/08/Detection and Segmentation/index.html">
<meta property="og:site_name" content="Jiburiru&#39;s Blog">
<meta property="og:description" content="簡述CS231n Lecture 11的內容 先說一下目前有哪些問題 Semantic Segmentation簡述只在乎pixelLabel圖片中所有的pixel來分類 不可行…計算量太大 換個方法 一開始計算量很大 問題來了Upsampling怎麼做 有兩種 如圖要碼複製 要碼放0 另外一種取最大 當做是Rescale   FCN(Fully Convolutional networks)綜述">
<meta property="og:locale" content="zh-TW">
<meta property="og:image" content="https://i.imgur.com/C1bfkk6.jpg">
<meta property="og:image" content="https://i.imgur.com/VTp8YIM.jpg">
<meta property="og:image" content="https://i.imgur.com/FdygjfH.jpg">
<meta property="og:image" content="https://i.imgur.com/TDk5J2e.jpg">
<meta property="og:image" content="https://i.imgur.com/5MCttJi.jpg">
<meta property="og:image" content="https://i.imgur.com/7SnFZWv.jpg">
<meta property="og:image" content="https://i.imgur.com/bM31yNc.jpg">
<meta property="og:image" content="https://i.imgur.com/4tzSCI1.jpg">
<meta property="og:image" content="https://i.imgur.com/gee3hq1.jpg">
<meta property="og:image" content="https://i.imgur.com/FfwSe8r.jpg">
<meta property="og:image" content="https://i.imgur.com/LEyGDPa.jpg">
<meta property="og:image" content="https://i.imgur.com/GeWYEt8.jpg">
<meta property="og:image" content="https://i.imgur.com/aSSVUW0.jpg">
<meta property="og:image" content="https://i.imgur.com/bxDd1Go.jpg">
<meta property="og:image" content="https://i.imgur.com/LT1oY4m.jpg">
<meta property="og:image" content="https://i.imgur.com/Zou15pP.jpg">
<meta property="og:image" content="https://i.imgur.com/417BbLS.jpg">
<meta property="og:image" content="https://i.imgur.com/kKgxLGT.jpg">
<meta property="og:image" content="https://i.imgur.com/ZCtiXav.jpg">
<meta property="og:image" content="https://i.imgur.com/luPIE1W.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/1047939/201704/1047939-20170426134929553-607353721.png">
<meta property="og:image" content="https://i.imgur.com/P08IDWX.jpg">
<meta property="og:image" content="https://img.itw01.com/images/2017/12/09/00/4503_Fode7X_2N4NEMF.jpg">
<meta property="og:image" content="https://i.imgur.com/7iLhksz.jpg">
<meta property="og:image" content="https://i.imgur.com/1bm36Aq.jpg">
<meta property="og:image" content="https://i.imgur.com/lRS9hMh.png">
<meta property="og:image" content="https://i.imgur.com/PDODwbS.jpg">
<meta property="og:image" content="https://blog.csdn.net/u010167269/article/details/52563573">
<meta property="og:image" content="http://cs231n.stanford.edu/slides/2017/cs231n_2017_lecture11.pdf">
<meta property="og:updated_time" content="2019-09-30T08:00:23.659Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Detection and Segmentation">
<meta name="twitter:description" content="簡述CS231n Lecture 11的內容 先說一下目前有哪些問題 Semantic Segmentation簡述只在乎pixelLabel圖片中所有的pixel來分類 不可行…計算量太大 換個方法 一開始計算量很大 問題來了Upsampling怎麼做 有兩種 如圖要碼複製 要碼放0 另外一種取最大 當做是Rescale   FCN(Fully Convolutional networks)綜述">
<meta name="twitter:image" content="https://i.imgur.com/C1bfkk6.jpg">






  <link rel="canonical" href="https://accelsao.github.io/2018/07/08/Detection and Segmentation/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Detection and Segmentation | Jiburiru's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-TW">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jiburiru's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">心若沒有棲息的地方，到哪都是流浪</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切換導航欄">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首頁</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>關於</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>標籤</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分類</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>歸檔</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜尋</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜尋..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://accelsao.github.io/2018/07/08/Detection and Segmentation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiburiru">
      <meta itemprop="description" content="Just Do It">
      <meta itemprop="image" content="https://i.imgur.com/r1ouiFo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiburiru's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Detection and Segmentation

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2018-07-08 15:42:05" itemprop="dateCreated datePublished" datetime="2018-07-08T15:42:05+08:00">2018-07-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-09-30 16:00:23" itemprop="dateModified" datetime="2019-09-30T16:00:23+08:00">2019-09-30</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">評論數：</span>
                <a href="/2018/07/08/Detection and Segmentation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/07/08/Detection and Segmentation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>簡述CS231n Lecture 11的內容</p>
<p>先說一下目前有哪些問題<br><img src="https://i.imgur.com/C1bfkk6.jpg" alt><br><img src="https://i.imgur.com/VTp8YIM.jpg" alt></p>
<h1 id="Semantic-Segmentation"><a href="#Semantic-Segmentation" class="headerlink" title="Semantic Segmentation"></a>Semantic Segmentation</h1><h2 id="簡述"><a href="#簡述" class="headerlink" title="簡述"></a>簡述</h2><p>只在乎pixel<br>Label圖片中所有的pixel來分類<br><img src="https://i.imgur.com/FdygjfH.jpg" alt></p>
<p><img src="https://i.imgur.com/TDk5J2e.jpg" alt><br>不可行…計算量太大</p>
<p>換個方法</p>
<p><img src="https://i.imgur.com/5MCttJi.jpg" alt><br>一開始計算量很大</p>
<p><img src="https://i.imgur.com/7SnFZWv.jpg" alt><br>問題來了<br>Upsampling怎麼做</p>
<p><img src="https://i.imgur.com/bM31yNc.jpg" alt><br>有兩種 如圖<br>要碼複製 要碼放0</p>
<p>另外一種<br><img src="https://i.imgur.com/4tzSCI1.jpg" alt><br>取最大</p>
<p><img src="https://i.imgur.com/gee3hq1.jpg" alt><br>當做是Rescale </p>
<p><img src="https://i.imgur.com/FfwSe8r.jpg" alt></p>
<h2 id="FCN-Fully-Convolutional-networks"><a href="#FCN-Fully-Convolutional-networks" class="headerlink" title="FCN(Fully Convolutional networks)"></a>FCN(Fully Convolutional networks)</h2><p>綜述以上有點亂七八糟的東西</p>
<ol>
<li><p>Convolutionalization<br>一般網路 會接FC層 再接 分類層<br>但因為Segmentation 需要分割圖 所以把FC層替換成ConvNet 就是Idea: Fully Convolutional 那邊<br>因為FC層會把圖片壓縮成一維的 好方便接後面的分類標籤<br>Conv則還是二維</p>
</li>
<li><p>Upsampling<br>一般CNN會有池化 把圖片Size縮小<br>但我們需要和原圖一樣的分割圖<br>所以Downsampling 再接 Upsampling<br>方法呢 就是上述所說的 <strong>Transpose_Convolution</strong></p>
</li>
</ol>
<h1 id="Object-detection-傳統算法"><a href="#Object-detection-傳統算法" class="headerlink" title="Object detection 傳統算法"></a>Object detection 傳統算法</h1><h2 id="Sliding-Window"><a href="#Sliding-Window" class="headerlink" title="Sliding Window"></a>Sliding Window</h2><p>很暴力的方法<br><img src="https://i.imgur.com/LEyGDPa.jpg" alt></p>
<p>爆搜框框 說明這個框框是否是我要找的 是-&gt;yes 否-&gt;No<br>明顯困難點是怎麼選擇這個框框 因為物體在哪裡都有可能<br>運算花費極高</p>
<h2 id="Region-proposal"><a href="#Region-proposal" class="headerlink" title="Region proposal"></a>Region proposal</h2><p><img src="https://i.imgur.com/GeWYEt8.jpg" alt><br>顧名思義是找一些候選位置 挑出比較有可能的地方來處理</p>
<h1 id="R-CNN"><a href="#R-CNN" class="headerlink" title="R-CNN"></a>R-CNN</h1><p><img src="https://i.imgur.com/aSSVUW0.jpg" alt><br>先Region proposal挑出一些地方<br>但因為要放入ConvNet 所以要Resize<br>最後進入SVM 分類器</p>
<p><img src="https://i.imgur.com/bxDd1Go.jpg" alt></p>
<h2 id="Fast-RCNN"><a href="#Fast-RCNN" class="headerlink" title="Fast-RCNN"></a>Fast-RCNN</h2><p><img src="https://i.imgur.com/LT1oY4m.jpg" alt><br>一開始不先找<strong>候選區域</strong><br>直接ConvNet<br>然後再找<strong>候選位置</strong><br>稱之為Rol(Regions of Interest)</p>
<p><img src="https://i.imgur.com/Zou15pP.jpg" alt></p>
<p>然後進FC+分類器</p>
<p>整體大概是這樣<br><img src="https://i.imgur.com/417BbLS.jpg" alt></p>
<h2 id="Faster-RCNN"><a href="#Faster-RCNN" class="headerlink" title="Faster-RCNN"></a>Faster-RCNN</h2><p><img src="https://i.imgur.com/kKgxLGT.jpg" alt><br>和Fast-RCNN<br>差別就只是多了一層RPN(區域候選網路)<br>從CNN出來的feature 直接在這邊找候選 同一個網路框架</p>
<h2 id="SPP-Net"><a href="#SPP-Net" class="headerlink" title="SPP-Net"></a>SPP-Net</h2><p>這裡是CS231n沒有的 但還是記錄一些<br><img src="https://i.imgur.com/ZCtiXav.jpg" alt></p>
<p>原本的CNN要Resize圖片 然後才進入Conv Layer<br>但SPP 可以輸入任意Size 然後 通過 Spatial pyramid pooling 來生成固定size的圖片</p>
<p><img src="https://i.imgur.com/luPIE1W.png" alt><br><img src="https://images2015.cnblogs.com/blog/1047939/201704/1047939-20170426134929553-607353721.png" alt></p>
<h2 id="比較"><a href="#比較" class="headerlink" title="比較"></a>比較</h2><p><img src="https://i.imgur.com/P08IDWX.jpg" alt></p>
<h2 id="Mask-R-CNN"><a href="#Mask-R-CNN" class="headerlink" title="Mask R-CNN"></a>Mask R-CNN</h2><p><a href="https://arxiv.org/pdf/1703.06870.pdf" target="_blank" rel="noopener">paper limk</a></p>
<p><img src="https://img.itw01.com/images/2017/12/09/00/4503_Fode7X_2N4NEMF.jpg" alt></p>
<h3 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h3><p>和Faster的差別</p>
<ol>
<li>Roi pooling -&gt; RoiAlign</li>
<li>添加並列的FCN層(Lmask)</li>
</ol>
<h3 id="技術要點"><a href="#技術要點" class="headerlink" title="技術要點"></a>技術要點</h3><ol>
<li>用ResNeXt-101 + FPN </li>
<li>RoiAlign 引入插值過程 先通過雙線性插值到\(14X14\) 再pooling到 \(7X7\)<br>解決只通過pooling帶來的Misalignment問題</li>
<li>訓練過程中 在每個sampled RoI定義 <code>multi-task loss</code> as \(L = L_{cls}+L_{box}+L_{mask}\)<br>The classification loss and bounding-box loss are identical to Fast RCNN<br>The mask branch has a (K , \(m^{2}\)) - dimensional output for each RoI, which encodes K binary masks of resolution m × m, one for each of the K classes.<br>分成K個classes 應用 per-pixel sigmoid<br>\(L_{mask}\)定義為 average binary cross-entropy loss<br>這樣不同Classes之間就不會貢獻Loss給對方</li>
</ol>
<h1 id="YOLO-SSD"><a href="#YOLO-SSD" class="headerlink" title="YOLO/SSD"></a>YOLO/SSD</h1><p><img src="https://i.imgur.com/7iLhksz.jpg" alt></p>
<p>前述所說是基於Region Proposal的方法<br>這兩個呢 則是基於迴歸法<br>由給定圖像的多個位置上迴歸出這個位置的目標邊框和類別來提升檢測速度</p>
<h2 id="YOLO"><a href="#YOLO" class="headerlink" title="YOLO"></a>YOLO</h2><p>首先把圖片分割成 S X S<br>每一格會預測B個邊界框(bounding box)和邊界框的可信度(confidence score)<br>可信度包含兩個</p>
<ul>
<li>可能性大小 \(Pr(object)\) 包含目標=1 否則=0</li>
<li>準確度</li>
</ul>
<p>準確度可以用來預測和實際框(Ground truth)的IOU(intersection over union)<br>所以可信度(confidence score) 可以用\(Pr(object)*IOU^{truth}_{pred}\)表示<br>每個邊界框的預測值包含(x,y,w,h,c)<br>(x,y)位置 ,(w,h)大小 c可信度</p>
<p>每個單元格要預測(B<em>5+C)個值<br>最終預測量是(S,S,B</em>5+C)</p>
<p><img src="https://i.imgur.com/1bm36Aq.jpg" alt></p>
<h2 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h2><h3 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h3><p>SSD輸出一系列離散化(discretization)的bounding boxes<br>這些bounding boxes是在不同layers上的feature map 生成<br>在不同尺度上預測 增加準度還有不同aspect ratio結果</p>
<h4 id="預測階段"><a href="#預測階段" class="headerlink" title="預測階段"></a>預測階段</h4><p>要計算出每個default box的物體,其屬於每種類別的可能性,也就是scores<br>對這些bounding box的shape使其符合物體的外接矩形<br>比起基於region proposal的模型<br>SSD沒<strong>proposals generation</strong>,<strong>pixel resampling</strong>或<strong>feature resampling</strong>這些階段<br>所以在保證精度時 速度也快上許多</p>
<h3 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h3><p>現今流行的檢測步驟<br>先生成一些bounding boxes<br>從中提取特徵 在經過分類器 判斷是否是物體<br>Faster R-CNN的 ResNet 為了精度犧牲不少時間<br>但從YOLO開始 消除了boungind box , pixel of feature resampling的過程<br>SSD比起YOLO又好很多</p>
<h3 id="Core-Idea"><a href="#Core-Idea" class="headerlink" title="Core Idea"></a>Core Idea</h3><p>Our improvements include using a small convolutional filter to predict object categories and offsets in bounding box locations, using separate predictors (filters) for different aspect ratio detections, and applying these filters to multiple feature maps from the later stages of a network in order to perform detection at multiple scales.</p>
<h3 id="特點"><a href="#特點" class="headerlink" title="特點"></a>特點</h3><ol>
<li>速度&gt;YOLO 準度\(\approx \)Faster RCNN</li>
<li>SSD核心 predict <strong>object</strong> 和屬於哪種class的<strong>score</strong></li>
<li>在feature map 上使用小的Conv filter來predict一系列bounding box的<strong>box offsets</strong></li>
<li>在不同層次,尺度的feature map上predict <strong>object</strong>,<strong>box offests</strong>,得到不同<strong>aspect ratio</strong></li>
<li>end-to-end 訓練也變簡單, 在檢測速度和精度取得好的<strong>trade-off</strong></li>
</ol>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>SSD 是基於前向CNN 產生一系列的 <strong>fixed-size</strong> bounding boxes和boxes的scores 配上 NMS(Non-maximum suppression)得到predicts</p>
<p>除了基礎結構外增加</p>
<ul>
<li>Multi-scale feature maps for detection<br>額外的ConvNet layer 大小逐層遞減 來多尺度進行</li>
<li>Convolutional predictors for detection<br>每個增加的特徵層 用一系列的Convolutional filters,產生固定大小的predictions</li>
<li>Default boxes and aspect ratios<br>預測得到的box和default box的 offset(偏移值)<br>和每個box的scores(K個classes的機率都要算)<br>因此對於一個位置上的N個boxes中的每一個box,需要計算K-classes,每一個類的score還有這個box相對於他的默認box的4個offset<br>需要 (K+4) X N filters<br>對於h,w的size的特徵圖 就要 (K+4) X N X h X w 個predicts</li>
</ul>
<h3 id="比較圖"><a href="#比較圖" class="headerlink" title="比較圖"></a>比較圖</h3><p><img src="https://i.imgur.com/lRS9hMh.png" alt></p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p><img src="https://i.imgur.com/PDODwbS.jpg" alt></p>
<h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><p><img src="https://blog.csdn.net/u010167269/article/details/52563573" alt="论文阅读：SSD: Single Shot MultiBox Detector"><br><img src="http://cs231n.stanford.edu/slides/2017/cs231n_2017_lecture11.pdf" alt="cs231n_2017_lecture11"></p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CS231n/" rel="tag"># CS231n</a>
          
            <a href="/tags/Object-Detection/" rel="tag"># Object Detection</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/06/Group Normalization/" rel="next" title="Group Normalization">
                <i class="fa fa-chevron-left"></i> Group Normalization
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/09/Generative Models/" rel="prev" title="Generative Models">
                Generative Models <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            本站概要
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://i.imgur.com/r1ouiFo.jpg" alt="Jiburiru">
            
              <p class="site-author-name" itemprop="name">Jiburiru</p>
              <p class="site-description motion-element" itemprop="description">Just Do It</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">152</span>
                    <span class="site-state-item-name">文章</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">31</span>
                    <span class="site-state-item-name">分類</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">178</span>
                    <span class="site-state-item-name">標籤</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/accelsao" title="GitHub &rarr; https://github.com/accelsao" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://twitter.com/Jiburiru002" title="Twitter &rarr; https://twitter.com/Jiburiru002" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://exploredegrees.stanford.edu/schoolofengineering/computerscience/#bachelortext" title="https://exploredegrees.stanford.edu/schoolofengineering/computerscience/#bachelortext" rel="noopener" target="_blank">Stanford  CS</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.youtube.com/watch?v=gAbYAqq9jhc&t=2215s" title="https://www.youtube.com/watch?v=gAbYAqq9jhc&t=2215s" rel="noopener" target="_blank">成功的背後，你看到什麼？</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://coursecatalog.web.cmu.edu/schoolofcomputerscience/undergraduatecomputerscience/" title="http://coursecatalog.web.cmu.edu/schoolofcomputerscience/undergraduatecomputerscience/" rel="noopener" target="_blank">CMU CS CS</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://coursecatalog.web.cmu.edu/schoolofcomputerscience/artificialintelligence/#bsairoadmaptext" title="http://coursecatalog.web.cmu.edu/schoolofcomputerscience/artificialintelligence/#bsairoadmaptext" rel="noopener" target="_blank">CMU CS AI</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://morris821028.github.io/" title="http://morris821028.github.io/" rel="noopener" target="_blank">Morris Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.opasschang.com/article-list/" title="https://blog.opasschang.com/article-list/" rel="noopener" target="_blank">Opass Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://coshunie.com/about/" title="http://coshunie.com/about/" rel="noopener" target="_blank">Cö shu Nie / コシュニエ</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://docs.google.com/document/u/0/d/1xqYCb1iGDO-BPK3FoOtAPLn9tQYBiCy7CKx7aLsX84o/pub" title="https://docs.google.com/document/u/0/d/1xqYCb1iGDO-BPK3FoOtAPLn9tQYBiCy7CKx7aLsX84o/pub" rel="noopener" target="_blank">從加州理工到高盛銀行-粟耀瑩</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lilianweng.github.io/lil-log/" title="https://lilianweng.github.io/lil-log/" rel="noopener" target="_blank">LilLog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://optimaltransport.github.io/" title="https://optimaltransport.github.io/" rel="noopener" target="_blank">Computational Optimal Transport</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ai.googleblog.com/" title="https://ai.googleblog.com/" rel="noopener" target="_blank">Google AI Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://deepmind.com/blog/" title="https://deepmind.com/blog/" rel="noopener" target="_blank">DeepMind Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://island.shaform.com/zh/about/" title="https://island.shaform.com/zh/about/" rel="noopener" target="_blank">shaform blog</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Semantic-Segmentation"><span class="nav-number">1.</span> <span class="nav-text">Semantic Segmentation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#簡述"><span class="nav-number">1.1.</span> <span class="nav-text">簡述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FCN-Fully-Convolutional-networks"><span class="nav-number">1.2.</span> <span class="nav-text">FCN(Fully Convolutional networks)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Object-detection-傳統算法"><span class="nav-number">2.</span> <span class="nav-text">Object detection 傳統算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Sliding-Window"><span class="nav-number">2.1.</span> <span class="nav-text">Sliding Window</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Region-proposal"><span class="nav-number">2.2.</span> <span class="nav-text">Region proposal</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#R-CNN"><span class="nav-number">3.</span> <span class="nav-text">R-CNN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Fast-RCNN"><span class="nav-number">3.1.</span> <span class="nav-text">Fast-RCNN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Faster-RCNN"><span class="nav-number">3.2.</span> <span class="nav-text">Faster-RCNN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SPP-Net"><span class="nav-number">3.3.</span> <span class="nav-text">SPP-Net</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#比較"><span class="nav-number">3.4.</span> <span class="nav-text">比較</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mask-R-CNN"><span class="nav-number">3.5.</span> <span class="nav-text">Mask R-CNN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#介紹"><span class="nav-number">3.5.1.</span> <span class="nav-text">介紹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#技術要點"><span class="nav-number">3.5.2.</span> <span class="nav-text">技術要點</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#YOLO-SSD"><span class="nav-number">4.</span> <span class="nav-text">YOLO/SSD</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#YOLO"><span class="nav-number">4.1.</span> <span class="nav-text">YOLO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSD"><span class="nav-number">4.2.</span> <span class="nav-text">SSD</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Abstract"><span class="nav-number">4.2.1.</span> <span class="nav-text">Abstract</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#預測階段"><span class="nav-number">4.2.1.1.</span> <span class="nav-text">預測階段</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#introduction"><span class="nav-number">4.2.2.</span> <span class="nav-text">introduction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Core-Idea"><span class="nav-number">4.2.3.</span> <span class="nav-text">Core Idea</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#特點"><span class="nav-number">4.2.4.</span> <span class="nav-text">特點</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Model"><span class="nav-number">4.2.5.</span> <span class="nav-text">Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#比較圖"><span class="nav-number">4.2.6.</span> <span class="nav-text">比較圖</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#其他"><span class="nav-number">5.</span> <span class="nav-text">其他</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#參考"><span class="nav-number">6.</span> <span class="nav-text">參考</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiburiru</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 強力驅動 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  
  
  <script id="dsq-count-scr" src="https://accel.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "https://accelsao.github.io/2018/07/08/Detection and Segmentation/";
    this.page.identifier = "2018/07/08/Detection and Segmentation/";
    this.page.title = 'Detection and Segmentation';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://accel.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
